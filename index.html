<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>AI è¡Œç¨‹åŠ©ç†ï¼ˆå…è²» / è®€åœ–ç‰‡ï¼‰</title>
<script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@latest/dist/index.min.js"></script>

<style>
body {
  background: #0a0f24;
  color: #e2e8f0;
  display: flex;
  justify-content: center;
  font-family: Arial;
  padding: 30px;
}
.container {
  width: 100%;
  max-width: 700px;
  background: rgba(255,255,255,0.05);
  padding: 25px;
  border-radius: 15px;
  border: 1px solid #00d9ff;
  box-shadow: 0 0 15px rgba(0,200,255,0.25);
}
h1 {
  text-align: center;
  color: #00eaff;
  text-shadow: 0 0 10px #00eaff;
}
#chat {
  height: 360px;
  overflow-y: auto;
  padding: 12px;
  border: 1px solid #00bcd4;
  border-radius: 10px;
  background: rgba(255,255,255,0.07);
  margin-bottom: 12px;
}
.msg {
  margin: 8px 0;
  padding: 10px;
  border-radius: 8px;
  max-width: 80%;
}
.me {
  background: #00bcd4;
  color: #000;
  margin-left: auto;
}
.bot {
  background: rgba(255,255,255,0.15);
  border: 1px solid #00d9ff;
}
input, button {
  padding: 12px;
  width: 100%;
  margin-top: 8px;
  border-radius: 8px;
  border: none;
}
button {
  background: #00c2ff;
  color: black;
  font-weight: bold;
}
button:hover {
  background: #00e1ff;
}
</style>
</head>

<body>
<div class="container">
  <h1>AI è¡Œç¨‹åŠ©ç†ï¼ˆè®€åœ–ç‰‡ï¼‰</h1>

  <div id="chat"></div>

  <input type="file" id="img" accept="image/*">
  <input id="text" placeholder="è¼¸å…¥è¨Šæ¯..." />

  <button onclick="send()">é€å‡º</button>
</div>

<script>
let model;

// åˆå§‹åŒ–æ¨¡å‹
(async () => {
  add("â³ æ­£åœ¨è¼‰å…¥ AI æ¨¡å‹â€¦ï¼ˆç´„ 5~10 ç§’ï¼‰", "bot");
  model = await webllm.CreateMLCEngine(
    "Phi-3.5-vision-instruct-q4f32_1-MLC", 
    { reinit: true }
  );
  add("âœ¨ æ¨¡å‹è¼‰å…¥å®Œæˆï¼ä½ å¯ä»¥é–‹å§‹èŠå¤©æˆ–ä¸Šå‚³è¡Œç¨‹åœ–ç‰‡ã€‚", "bot");
})();

function add(text, who) {
  const box = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "msg " + who;
  div.textContent = text;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

async function send() {
  const text = document.getElementById("text").value;
  const img = document.getElementById("img").files[0];

  if (!text && !img) return;

  // é¡¯ç¤ºè‡ªå·±çš„è¨Šæ¯
  if (text) add(text, "me");
  if (img) add("ğŸ“· å·²ä¸Šå‚³è¡Œç¨‹åœ–ç‰‡", "me");

  document.getElementById("text").value = "";

  // è™•ç†åœ–ç‰‡
  let imageBase64 = null;
  if (img) {
    imageBase64 = await new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result.split(",")[1]);
      reader.readAsDataURL(img);
    });
  }

  // AI å›æ‡‰
  const prompt = text || "è«‹å¹«æˆ‘é–±è®€é€™å¼µè¡Œäº‹æ›†åœ–ç‰‡ï¼Œæ•´ç†æˆè¡Œç¨‹ã€‚";

  const response = await model.chat.completions.create({
    messages: [
      { role: "user", content: prompt },
      ...(imageBase64
        ? [{
            role: "user",
            content: [
              { type: "text", text: prompt },
              { type: "image", image: imageBase64 },
            ],
          }]
        : [])
    ]
  });

  add(response.choices[0].message.content, "bot");
}
</script>
</body>
</html>
